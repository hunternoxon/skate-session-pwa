<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Brainlock Inline Baseline</title>
  <meta name="theme-color" content="#0b0b0c" />
  <style>
    :root{--bg:#0b0b0c;--card:#141416;--muted:#8a8e93;--text:#f3f4f6;--accent:#0ea5e9;--ok:#22c55e;--bad:#ef4444;--ghost:#1c1d20;--border:#222327}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);color:var(--text);font:16px -apple-system,system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;-webkit-font-smoothing:antialiased;line-height:1.35}
    .hidden{display:none!important}
    .topbar{position:sticky;top:0;z-index:7;display:grid;grid-template-columns:1fr auto;align-items:center;gap:8px;padding:8px 12px;border-bottom:1px solid var(--border);background:rgba(11,11,12,0.85);backdrop-filter:blur(8px)}
    .brand-left{font-weight:800;letter-spacing:.2px;margin:0;cursor:pointer;font-size:18px;line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .icon{font-size:18px}
    .ghost{background:var(--ghost);color:var(--text);border:1px solid var(--border);padding:10px 12px;border-radius:9999px;font-size:18px;min-height:40px;min-width:40px}
    .primary{background:#fff;color:#0b0b0c;border:1px solid #fff;padding:14px 18px;border-radius:9999px;font-weight:800}
    .success{background:var(--ok);color:#051507;border:none;padding:14px 18px;border-radius:9999px;font-weight:800}
    .danger{background:var(--bad);color:#160203;border:none;padding:14px 18px;border-radius:9999px;font-weight:800}
    .card{margin:16px;padding:16px;border:1px solid var(--border);border-radius:16px;background:var(--card)}
    .sheet{position:fixed;left:0;right:0;bottom:0;z-index:3;border-top-left-radius:18px;border-top-right-radius:18px;margin:0;padding:16px;background:var(--card);max-height:58vh;overflow:auto;padding-bottom:calc(env(safe-area-inset-bottom) + 28px)}
    .letters-sheet{display:flex;justify-content:center;gap:0.8ch}
    .letters-sheet>span{font-weight:900;font-size:clamp(26px,9vw,48px);color:#7f858c}
    .letters-sheet>span.lost{color:#ffffff}
    .scoreline{font-weight:700}
    .hero-emoji{font-size:42px;opacity:.9;text-align:center;margin:8px 0 14px}
    .trick.bigtitle{font-size:28px;font-weight:800;padding:16px;background:#101215;border:1px dashed var(--border);border-radius:14px;min-height:72px;display:flex;flex-direction:column;gap:10px}
    .trick-topline{display:flex;justify-content:space-between;align-items:center}
    .badge{font-size:12px;color:#cbd5e1;background:#0b0c0e;border:1px solid var(--border);padding:4px 8px;border-radius:9999px}
    .actions{display:flex;gap:12px;justify-content:flex-end;margin:16px 0;flex-wrap:wrap}
    .sheet-actions{display:flex;justify-content:flex-start;margin-top:8px}
    .foot{padding:16px;color:var(--muted);border-top:1px solid var(--border)}
    /* Modal hard hide to avoid tap blockers */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:10}
    .modal.hidden{display:none !important;pointer-events:none !important}
    .modal-card{background:#141416;border:1px solid var(--border);border-radius:16px;max-width:820px;width:92vw;padding:0;max-height:88vh;display:flex;flex-direction:column;overflow:hidden}
    .modal-header, .modal-footer{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;border-bottom:1px solid var(--border)}
    .pane{padding:14px;overflow:auto;max-height:70vh}
    /* Tricks overlay hierarchy */
    .list{display:flex;flex-direction:column;gap:8px}
    .list label.cat{font-size:28px;font-weight:900;padding:12px 14px;background:#101215;border:1px solid #2a2b2f;display:block;margin:10px 0 8px 0;border-radius:14px}
    .list input[type="checkbox"].cat{transform:scale(1.6)}
    .list .sub{margin:8px 0 20px 16px;border-left:2px solid #232429;padding-left:12px}
    .list .sub label{font-size:14px;font-weight:600;background:#0e0f11;border:1px solid #1f2024;border-radius:12px;padding:8px 10px}
  </style>
</head>
<body>
  <div class="safe">
    <header class="topbar">
      <h1 id="titleText" class="brand-left">Brainlock Inline Baseline</h1>
      <button id="dbgBtn" class="ghost icon" aria-label="Debug">DBG</button>
    </header>

    <main id="screen">
      <section class="card sheet" id="sheet">
        <div class="sheet-header">
          <div id="letters" class="letters-sheet"><span>S</span><span>K</span><span>A</span><span>T</span><span>E</span></div>
          <div id="scoreLine" class="scoreline">High Score: <button id="openHigh" class="ghost">0 pts</button></div>
        </div>

        <div id="viewSetup" class="view active">
          <div class="hero-emoji">ðŸ§  ðŸ”’ ðŸ›¹</div>
          <button id="startBtn" class="primary xl full start-cta">Start Session</button>
        </div>

        <div id="viewGame" class="view hidden">
          <div id="trick" class="trick bigtitle">
            <div class="trick-topline">
              <span id="attemptBadge" class="badge">Attempt 1/3</span>
              <button id="openAttempt" class="badge right as-link">This attempt: â€”</button>
            </div>
            <div id="trickText">â€”</div>
          </div>

          <div class="actions right" id="actionRow">
            <button id="skipBtn" class="ghost xl">Skip</button>
            <button id="missBtn" class="danger xl">Miss</button>
            <button id="landBtn" class="success xl">Land</button>
            <button id="nextBtn" class="primary xl hidden">Next</button>
          </div>

          <div class="sheet-actions">
            <button id="endBtn" class="ghost lg left">End Session</button>
          </div>
        </div>

        <div id="viewOver" class="view hidden">
          <div class="hero-emoji">ðŸ§  ðŸ”’ ðŸ›¹</div>
          <div class="row spaced">
            <div class="big">Final: <span id="finalScore">0 pts</span></div>
            <div class="big right">High: <button id="openHigh2" class="ghost">0 pts</button></div>
          </div>
          <button id="restartBtn" class="primary xl full">New Session</button>
        </div>
      </section>
    </main>

    <footer class="foot">v0.5.6-inline â€¢ Updated: 2025-08-12</footer>
  </div>

  <div id="overlay" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header"><h3 id="modalTitle">Overlay</h3></div>
      <div id="modalBody" class="pane"></div>
      <div class="modal-footer"><button id="modalClose" class="ghost">X</button></div>
    </div>
  </div>
  <div id="confirm" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header"><h3>End session?</h3></div>
      <div class="pane">Are you sure you want to end this session now?</div>
      <div class="modal-footer"><button id="confirmYes" class="danger">Yes, end</button><button id="confirmNo" class="ghost">Cancel</button></div>
    </div>
  </div>
  <div id="settings" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header"><h3>About & Tools</h3></div>
      <div class="pane">
        <div class="list">
          <label class="cat"><input class="cat" type="checkbox" checked/> Tricks (category example)</label>
          <div class="list sub">
            <label><input type="checkbox" checked/> Kickflip</label>
            <label><input type="checkbox" checked/> Heelflip</label>
          </div>
        </div>
      </div>
      <div class="modal-footer"><button id="settingsClose" class="ghost">X</button></div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => { 
      ['overlay','confirm','settings'].forEach(id=>{
        const m=document.getElementById(id);
        if(m){ m.classList.add('hidden'); m.setAttribute('aria-hidden','true'); }
      });

      const qs = id => document.getElementById(id);
      const els = { 
        dbgBtn:qs('dbgBtn'),
        startBtn:qs('startBtn'), viewSetup:qs('viewSetup'), viewGame:qs('viewGame'), viewOver:qs('viewOver'),
        skipBtn:qs('skipBtn'), missBtn:qs('missBtn'), landBtn:qs('landBtn'), nextBtn:qs('nextBtn'),
        scoreLine:qs('scoreLine'), letters:qs('letters'), attemptBadge:qs('attemptBadge'),
        openAttempt:qs('openAttempt'), trickText:qs('trickText'),
        endBtn:qs('endBtn'), finalScore:qs('finalScore'), restartBtn:qs('restartBtn')
      };

      function setNextVisible(on){
        els.nextBtn.classList.toggle('hidden', !on);
        [els.skipBtn, els.missBtn, els.landBtn].forEach(b=> b.classList.toggle('hidden', on));
      }

      let misses=0,total=0,attempt=1;

      function updateLetters(){ [...els.letters.children].forEach((s,i)=> s.classList.toggle('lost', i<misses)); }

      function setView(v){
        els.viewSetup.classList.toggle('hidden', v!=='setup');
        els.viewGame.classList.toggle('hidden', v!=='game');
        els.viewOver.classList.toggle('hidden', v!=='over');
        if(v==='setup') els.scoreLine.innerHTML = 'High Score: <button class="ghost">0 pts</button>';
        if(v==='game')  els.scoreLine.textContent = 'Total Score: '+ total +' pts';
      }

      function generateTrick(){ return { flip:'kickflip', obstacle:'flat' }; }
      function describe(c){ return (c.flip||'kickflip') + ' on ' + (c.obstacle||'flat'); }
      function computeScore(){ return { final: 200 }; }

      function nextTrick(){
        attempt=1;
        const current = generateTrick();
        els.trickText.textContent = describe(current);
        els.attemptBadge.textContent = 'Attempt 1/3';
        setNextVisible(false);
        els.skipBtn.disabled=false;els.missBtn.disabled=false;els.landBtn.disabled=false;
      }

      function settle(hit){
        if(hit){
          const rep = computeScore();
          total += rep.final;
          els.scoreLine.textContent = 'Total Score: ' + total + ' pts';
          setNextVisible(true);
          els.skipBtn.disabled=true;els.missBtn.disabled=true;els.landBtn.disabled=true;
        }else{
          if(attempt<3){ attempt++; els.attemptBadge.textContent = 'Attempt '+attempt+'/3'; }
          else{
            misses++; updateLetters();
            setNextVisible(true);
            els.skipBtn.disabled=true;els.missBtn.disabled=true;els.landBtn.disabled=true;
          }
        }
      }

      els.dbgBtn && els.dbgBtn.addEventListener('click', ()=> alert('JS live inline baseline'));
      els.startBtn.addEventListener('click', ()=>{ misses=0; total=0; attempt=1; updateLetters(); setView('game'); nextTrick(); });
      els.skipBtn.addEventListener('click', ()=>{ setNextVisible(false); nextTrick(); });
      els.missBtn.addEventListener('click', ()=> settle(false));
      els.landBtn.addEventListener('click', ()=> settle(true));
      els.nextBtn.addEventListener('click', ()=> nextTrick());
      els.endBtn.addEventListener('click', ()=>{ setView('setup'); });

      setView('setup'); updateLetters();
    });
  </script>
</body>
</html>
